{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% load custom_filters %}

{% block content %}

<div class="container">
	<div class="row d-flex justify-content-between mt-3">
		<div class="col-lg-8">
			<div class="row d-flex align-items-center">
				<a href="{% url 'ideas:author' idea.author.username %}" class="d-flex align-items-center">
					<img class="idea-profile-image mr-2" src="{{ idea.author.author.image.url }}" alt="profile-avatar">
					<h3>{{ idea.author.username }}</h3>
				</a>
				<div>
                    <p class="text-muted ml-2 mb-0"><i class="bi bi-clock"></i> {{ idea.date_posted|timesince }} ago</p>
                </div>
			</div>
			<div class="row">
				<h4>{{ idea.title }}</h4>
				<p class="pb-3">{{ idea.idea }}</p>
			</div>
		</div>

		<!-- Rating Section -->
		<div class="border border-dark rounded col-lg-2">
			{% if rating|is_numeric %}
				<h5>Rating {{ rating|floatformat:1 }}/10</h5>
			{% else %}
				<p>Be the first to rate this idea</p>
			{% endif %}
			<form method="post">
				{% csrf_token %}
				{{ rating_form|crispy }}
				{% if user_rating_value %}
					<p class="text-success">You rated this {{ user_rating_value }}/10</p>
				{% endif %}

				{% if user.is_authenticated %}
					<button type="submit" class="btn btn-primary">Submit</button>
				{% else %}
					<a href="{% url 'users:login' %}?next={{ request.path }}" class="btn btn-primary">Login</a>
				{% endif %}
			</form>
		</div>
	</div>

	<!-- Comments section -->
	<h5>New Comment:</h5>
	<div class="row mb-4">
		<form method="post" class="col-lg-12">
			{% csrf_token %}
			{{ comment_form|crispy }}
	
			{% if user.is_authenticated %}
				<button type="submit" class="btn btn-primary">Submit</button>
			{% else %}
				<a href="{% url 'users:login' %}?next={{ request.path }}" class="btn btn-primary">Login</a>
			{% endif %}
		</form>
	</div>
	<div class="row">
		{% if comments %}
		<div class="col-lg-12">
			<!-- number of comments -->
			{% if comments_count == 1 %}
				<h5>{{ comments_count }} Comment</h5>
			{% else %}
				<h5>{{ comments_count }} Comments</h5>
			{% endif %}

			{% for comment in comments %}
			<div class="d-flex mb-2">
				<img class="home-profile-image mr-2" src="{{ comment.author.author.image.url }}" alt="profile-avatar">
				<div class="card w-100">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<a href="{% url 'ideas:author' comment.author.username %}">
								<h5 class="card-title">{{ comment.author.username }}</h5>
							</a>
							<p class="text-muted"><i class="bi bi-clock"></i> {{ comment.date_commented|timesince }} ago</p>
						</div>
						<p class="card-text">{{ comment.comment }}</p>
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
		{% endif %}
	</div>
</div>


{% endblock %}